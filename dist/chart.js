(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e():typeof define==="function"&&define.amd?define(e):(t=t||self,t.Chart=e())})(this,function(){"use strict";function t(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(t){return typeof t}}else{t=function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return t(e)}var e=1;var i="x";var a="line";var r="area";var s="bar";var n=25;var h=50;var o=70;var l="data";var c=20;var u="left";var v="right";var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var f=["January","February","March","April","May","June","Jule","August","September","October","November","December"];var p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function g(t){var e=false;t.yAxes.forEach(function(t){if(t.visible){e=e||t.percentage}});return e}function m(t,e,i,a){return{id:t,column:e,type:i,color:a.colors[t],name:a.names[t],visible:true,groupId:null,yAxis:null,stacked:false,opacity:1,power:1,transitions:[]}}function b(t,e,i,a,r){t.transitions.push([e,i,a,t[e],r])}function x(t){t.transitions.length=0}var C=0;var w=1;var y=2;var S=3;var k=4;function M(t){return Boolean(t.transitions.length)}function $(t,e){if(M(t)){for(var i=0;i<t.transitions.length;i+=1){if(t.transitions[i][C]===e){return true}}}return false}function A(t,e){if(!M(t)){return 0}var i=t.transitions;var a=i.length;for(var r=0;r<i.length;r+=1){var s=i[r];var n=s[S];var h=s[k];var o=n+(e-s[w])*(h-n)/s[y];if(n>h&&o<=h||n<=h&&o>=h){o=h;a-=1}t[s[C]]=o}if(i.length&&!a){i.length=0}return a}var I=Math.log10||function(t){return Math.log(t)/Math.LN10};function T(t,e,i,a){var r=a.min,s=a.max;for(var n=e;n<=i;n+=1){if(t[n]>s){s=t[n]}if(t[n]<r){r=t[n]}}return{min:r,max:s}}function _(t,e,i){if(i===void 0){i=5}var a=(e-t)*.75;var r=a/i;var s=Math.floor(I(r));var n=Math.pow(10,s);var h=Math.floor(r/n+.5);var o=n*h;var l=o*Math.floor(t/o);var c=o*Math.ceil(e/o);var u=Math.round((c-l)/o);if(u>i){o=o<10?o+1:Math.round(o*u/i);c=l+o*i}else if(u<i){c=Math.round(o*i)}return{min:l,max:c,step:o}}function E(t,e){var i=Math.round(e/t);var a=1;while(a<i){a*=2}return a}function H(t,i){while(t<e){t+=i}return t}function N(t){return t.getUTCDate()+" "+d[t.getUTCMonth()]}function F(t){return t.getUTCDate()+" "+f[t.getUTCMonth()]}function L(t){return F(t)+" "+t.getUTCFullYear()}function P(t){return p[t.getUTCDay()]+", "+N(t)+" "+t.getUTCFullYear()}function R(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}var W=R();var D=function t(e,i,a,r){return{x:e,y:i,width:a,height:r}};function z(e,i,a){var r=document.createElement(e);if(i){r.className=i}if(t(a)==="object"){for(var s in a){r.setAttribute(s,a[s])}}return r}function Z(t,e){var i=t.className+" "+e;t.className=i.trim()}function X(t,e){t.className=t.className.replace(e,"").replace(/\s/g," ").trim()}function V(t){t.style.display="none"}function J(t){t.style.display=null}function Y(t,e,i,a){e.split(",").forEach(function(e){return t.addEventListener(e,i,a)})}function q(t,e,i){e.split(",").forEach(function(e){return t.removeEventListener(e,i)})}function B(t){return(t.touches?t.touches[0]:t).pageX}function U(t){if(t.touches){var e=t.touches[0];var i=e.target.getBoundingClientRect();return e.clientX-i.left}else{return t.offsetX}}function O(t,e){e.forEach(function(e){if(e in t){t[e]=t[e].bind(t)}})}var j={"-webkit-filter":"Filter_filter-1_Qgx",filter:"Filter_filter-1_Qgx",checkbox:"Filter_checkbox-37oPe",input:"Filter_input-yqUE1",icon:"Filter_icon-1IpOz",label:"Filter_label-3nMgK",day:"Filter_day-2l6Yo",night:"Filter_night-3MNmW"};function G(t){var e='<input class="'+j.input+'" name="'+t.id+'" type="checkbox" '+(t.visible?"checked":"")+">";var i='<div class="'+j.icon+'"></div>';var a='<div class="'+j.label+'">'+t.name+"</div>";return'<label class="'+j.checkbox+'" style="color:'+t.color+'">'+e+i+a+"</label>"}var K=function(){function t(t,e){this.themeName=null;this.state=t;this.$el=z("div",j.filter);this.render();this.$el.addEventListener("change",function(t){var i=t.target,a=i.name,r=i.checked;return e(a,r)})}var e=t.prototype;e.setTheme=function t(e){if(this.themeName){X(this.$el,j[this.themeName])}Z(this.$el,j[e]);this.themeName=e};e.render=function t(){var e=this.state.data;if(e.length>1){this.$el.innerHTML=e.reduce(function(t,e){return t+G(e)},"")}};return t}();var Q={scroll:"Scroll_scroll-iTusj",canvas:"Scroll_canvas-2wzZL",cover:"Scroll_cover-3gg5l",day:"Scroll_day-nNWqJ",night:"Scroll_night-16SZq",slider:"Scroll_slider-2chX9",leftHand:"Scroll_leftHand-34oNu",rightHand:"Scroll_rightHand-3GcYT",centerHand:"Scroll_centerHand-7WkGf"};var tt;var et=(tt={},tt[Q.leftHand]=true,tt[Q.rightHand]=true,tt[Q.centerHand]=true,tt);var it=15;var at=function(){function t(t,e,i){this.themeName=null;this.range=t;this.minRange=e;this.state={left:0,right:0};this.visible=true;this.activeControl=null;this.prevPageX=null;this.onChange=i;this.initDom();O(this,["handleMove","handleMoveEnd","handleMoveStart"]);Y(this.$el,"mousedown,touchstart",this.handleMoveStart)}var e=t.prototype;e.initDom=function t(){this.$el=z("div",Q.scroll);this.$canvas=z("canvas",Q.canvas);this.$leftCover=z("div",Q.cover);this.$rightCover=z("div",Q.cover);this.$slider=z("div",Q.slider);this.$slider.innerHTML='<div class="'+Q.leftHand+'"></div><div class="'+Q.rightHand+'"></div><div class="'+Q.centerHand+'"></div>';this.$el.appendChild(this.$canvas);this.$el.appendChild(this.$leftCover);this.$el.appendChild(this.$rightCover);this.$el.appendChild(this.$slider)};e.destroy=function t(){this.activeControl=null;this.detachMoveEvents();q(window,"mousedown,touchstart",this.handleMoveStart)};e.update=function t(){var e=this.$el,i=e.offsetHeight,a=e.offsetTop,r=e.offsetWidth;this.vp=D(0,a,r,i);this.width=this.vp.width-2*it;this.leftMin=it;this.rightMax=this.width+it;this.updateState();this.redrawControls()};e.updateState=function t(){this.state.left=Math.round(this.range[0]*this.width)+it;this.state.right=Math.round(this.range[1]*this.width)+it;this.state.minWidth=Math.round(this.minRange*this.width)};e.updateRange=function t(){this.range[0]=(this.state.left-it)/this.width;this.range[1]=(this.state.right-it)/this.width};e.setTheme=function t(e){if(this.themeName){X(this.$el,Q[this.themeName])}Z(this.$el,Q[e]);this.themeName=e};e.setRange=function t(e){this.range=e;this.updateState()};e.attachMoveEvents=function t(){Y(window,"mousemove,touchmove",this.handleMove);Y(window,"mouseup,touchend,touchcancel",this.handleMoveEnd)};e.detachMoveEvents=function t(){q(window,"mousemove,touchmove",this.handleMove);q(window,"mouseup,touchend,touchcancel",this.handleMoveEnd)};e.handleMoveStart=function t(e){var i=e.target.className;if(et[i]){this.activeControl=i;this.prevPageX=B(e);this.attachMoveEvents()}};e.handleMove=function t(e){var i=this;var a=B(e)-this.prevPageX;if(a){var r=this.applyDelta(a);if(r){this.prevPageX+=r;this.updateRange();this.onChange(this.range);W(function(){return i.redrawControls()})}}};e.handleMoveEnd=function t(){this.activeControl=null;this.detachMoveEvents()};e.applyDelta=function t(e){var i=this.state,a=i.left,r=i.right,s=i.minWidth;var n=r-a;var h=e;var o=a;var l=r;if(this.activeControl===Q.leftHand){o+=e;if(o>r-s){o=r-s}else if(o<this.leftMin){o=this.leftMin}h=o-a}else if(this.activeControl===Q.rightHand){l+=e;if(l<a+s){l=a+s}else if(l>this.rightMax){l=this.rightMax}h=l-r}else if(this.activeControl===Q.centerHand){o+=e;l+=e;if(l>this.rightMax){l=this.rightMax;o=l-n}else if(o<this.leftMin){o=this.leftMin;l=o+n}h=o-a}this.state.left=o;this.state.right=l;return h};e.redrawControls=function t(){var e=this.$slider,i=this.$leftCover,a=this.$rightCover,r=this.width;var s=this.state,n=s.left,h=s.right;e.style.cssText="left:"+(n-it)+"px; right: "+(r-h+it)+"px";i.style.right=r-n+2*it+"px";a.style.left=h+"px"};return t}();var rt=function(){function t(t,i){var a=[];var r=[];for(var s=e;s<t.length;s+=1){a[s]=new Date(t[s])}this.dataSize=t.length-e;this.type=i;this.column=t;this.dates=a;this.labels=r;this.tickWidth=null;this.tickStep=null;this.indexStep=null;this.opacityStep=null;this.offset=0;this.scale=0;this.opacity=0;this.transitions=[];this.preview={offset:0,scale:0}}var i=t.prototype;i.prepare=function t(i){var a=this.dataSize-1;var r=this.type===l?o:h;this.tickWidth=r/i;this.anchorIndex=Math.round(a*(1-this.tickWidth/2))+e};i.getLabel=function t(e){return N(this.dates[e])};i.getOpacity=function t(e){return 1};i.updateScale=function t(i,a,r){var s=i[1]-i[0];var n=a/((this.dataSize-1)*s);var h=-(a*i[0]/s+e*n);var o=E(n,this.tickWidth);var l=this.anchorIndex%o;var c=Math.round((this.dataSize-1)*i[0])+e;c-=(c-l)%o;c=H(c,o);var u=this.tickStep;var v=this.indexStep,d=this.opacity,f=this.opacityStep;if(!u){x(this);d=1;v=o;f=o}else if(u!==o){if(o>u){d=1;v=Math.max(1,o/2);f=o}else{d=0;v=o;f=o*2}if(r){x(this);b(this,"opacity",r,200,1-d)}else{d=1-d}}this.offsetIndex=l;this.startIndex=c;this.tickStep=o;this.indexStep=v;this.opacity=d;this.opacityStep=f;this.offset=h;this.scale=n;this.preview.scale=a/(this.dataSize-1);this.preview.offset=-e*this.preview.scale;this.init=false};return t}();var st=function(){function t(t){this.color=null;this.visible=false;this.stick=t;this.dataIds=[];this.totalStacked=[null];this.percentage=false;this.opacity=1;this.scale=0;this.ticks=null;this.transitions=[];this.preview={scale:0,ticks:null,visible:true,transitions:[]}}var i=t.prototype;i._updateScale=function t(e,i,a,r,s){var n=this.dataIds;var h=false;var o=false;var l={min:Infinity,max:-Infinity};for(var c=0;c<n.length;c+=1){var u=r[n[c]];if(u.visible){if(!u.stacked||u.stacked&&!o){l=T(u.column,i,a,l)}h=true;o=o||u.stacked}}if(o){l.min=0;l=T(this.totalStacked,i,a,l)}e.visible=h;if(!h){return}var v=e.ticks;if(this.percentage){var d={min:0,max:120,step:20};var f=120/l.max;if(!v||f!==e.scale){e.ticks=d;e.scale=f}return}var p=_(l.min,l.max);if(!v||v.min!==p.min||v.max!==p.max){e.ticks=p;var g=1/(p.max-p.min);if(v){e.opacity=0;b(e,"opacity",s,200,1);b(e,"scale",s,200,g)}else{e.scale=g}}};i.updateScale=function t(e,i,a,r){this._updateScale(this,e,i,a,r)};i.updatePreview=function t(e,i,a,r){this._updateScale(this.preview,e,i,a,r)};i.updateTotalStacked=function t(i){var a=this.dataIds,r=this.totalStacked;var s=0;for(var n=0;n<a.length;n+=1){var h=i[a[n]];if(h.visible&&h.stacked){var o=h.column;if(s===0){for(var l=e;l<o.length;l+=1){r[l]=o[l]}}else{for(var c=e;c<o.length;c+=1){r[c]+=o[c]}}s+=1}}};return t}();var nt=function(){function t(t){this.baseWidth=1;this.firstIndex=e;this.lastIndex=null;this.range=[0,1];this.ts=null;this.haveTransitions=false;this.prepareDataset(t)}var r=t.prototype;r.setRange=function t(e,i){var a=this.firstIndex,r=this.dataSize;this.range=e;this.updateXAxis();var s=r-1;var n=Math.floor(s*e[0])+a;var h=Math.ceil(s*e[1])+a;if(this.startIndex!==n||this.endIndex!==h){this.startIndex=n;this.endIndex=h;this.updateYAxes(i);this.haveTransitions=true}};r.setVisible=function t(e,i){var r=this.dataById;var s=r[e];if(s.visible!==i){s.visible=i;if(s.type===a||!s.stacked){b(s,"opacity",this.ts,200,i?1:0)}if(s.stacked&&!s.yAxis.percentage){b(s,"power",this.ts,200,i?1:0)}this.haveTransitions=true;this.updateYAxes(true)}};r.tick=function t(){var e=this.data,i=this.yAxes,a=this.xAxis,r=this.ts;var s=0;for(var n=0;n<e.length;n+=1){s+=A(e[n],r)}for(var h=0;h<i.length;h+=1){var o=i[h];s+=A(o,r);s+=A(o.preview,r)}s+=A(a,r);this.haveTransitions=Boolean(s)};r.prepareDataset=function t(a){var r=[];var s={};var n=[];var h;var o=Boolean(a.stacked);n[0]=new st(u);if(a.y_scaled){for(var c=1;c<a.columns.length;c+=1){n[c]=new st(c%2?v:u)}}var d=0;a.columns.forEach(function(t){var e=t[0];var c=a.types[e];if(c===i){h=new rt(t,l)}else{var u=m(e,t,c,a);r.push(u);s[e]=u;n[d].dataIds.push(e);u.stacked=o;u.groupId=d;u.yAxis=n[d];if(a.y_scaled){n[d].color=u.color;d+=1}}});if(a.percentage){n.forEach(function(t){t.percentage=true})}if(a.stacked){n.forEach(function(t){return t.updateTotalStacked(s)})}this.lastIndex=h.column.length-e;this.dataset=a;this.data=r;this.dataById=s;this.yAxes=n;this.xAxis=h;this.dataSize=h.column.length-this.firstIndex};r.prepareXAxis=function t(e){this.xAxis.prepare(e);this.updateXAxis(true)};r.updateXAxis=function t(e){this.xAxis.updateScale(this.range,this.baseWidth,this.ts,e)};r.updateYAxes=function t(e){var i=this.dataById,a=this.yAxes,r=this.firstIndex,s=this.startIndex,n=this.endIndex,h=this.lastIndex;for(var o=0;o<a.length;o+=1){a[o].updateTotalStacked(i);a[o].updateScale(s,n,i,this.ts);if(e){a[o].updatePreview(r,h,i,this.ts)}}};return t}();function ht(){return window.devicePixelRatio||1}var ot=ht();function lt(t){t.scale(ot,ot)}function ct(t){return t.getContext("2d")}function ut(t,e){t.save();lt(t);t.clearRect(e.x,e.y,e.width,e.height);t.restore()}function vt(t,e,i){t.font=i.fontSize+" "+i.fontFamily;t.fillStyle=e}function dt(t,e,i,n,h){if(n===void 0){n=false}if(h===void 0){h=2}var o=e.data,l=e.xAxis;var c;var u;var v;if(n){c=e.firstIndex;u=e.lastIndex;v=l.preview}else{c=e.startIndex;u=e.endIndex;v=l}t.save();var d=v.offset*i.width;var f=v.scale*i.width;var p;var g;var m={};for(var b=0;b<o.length;b+=1){var x=o[b];if(x.stacked&&$(x,"power")){var C=x.power,w=x.column;m[x.id]=true;if(!g){g=[];for(var y=c;y<=u;y+=1){g[y]=C*w[y]}}else{for(var S=c;S<=u;S+=1){g[S]+=C*w[S]}}}}var k=function e(l){var v=o[l];if(!(v.visible||M(v))){return"continue"}var g=v.column,m=v.yAxis,b=v.power,x=v.type;var C=m.percentage,w=m.totalStacked;var y=n?m.preview:m;var S=(C?100/y.ticks.max:y.scale)*i.height;var k=S*b;var $=y.ticks.min;t.save();lt(t);t.globalAlpha=v.opacity;t.beginPath();t.lineJoin="round";t.lineWidth=h;t.strokeStyle=v.color;t.fillStyle=v.color;var A=function t(e){return e*f+d};var I=void 0;if(v.stacked){if(!p){p=[];for(var T=c;T<=u;T+=1){p[T]=0}}I=C?function(t){return i.height-(p[t]+=(g[t]-$)*k/w[t])}:function(t){return i.height-(p[t]+=(g[t]-$)*k>>0||1)};t.globalCompositeOperation="destination-over"}else{I=C?function(t){return i.height-k*(g[t]-$)/y.ticks.max}:function(t){return i.height-(g[t]-$)*k}}if(x===a){t.moveTo(A(c),I(c));for(var _=c+1;_<=u;_+=1){t.lineTo(A(_),I(_))}t.stroke()}else if(x===s){var E=i.height;var H;var N;t.moveTo(A(c-.5),E);for(var F=c;F<=u;F+=1){N=A(F-.5);H=I(F);t.lineTo(N,H);t.lineTo(N+f,H)}t.lineTo(A(u+.5),E);t.closePath();t.fill()}else if(x===r){var L=i.height;t.moveTo(A(c),L);for(var P=c;P<=u;P+=1){t.lineTo(A(P),I(P))}t.lineTo(A(u),L);t.closePath();t.fill()}t.restore()};for(var A=0;A<o.length;A+=1){var I=k(A);if(I==="continue")continue}t.restore()}function ft(t,e,i,a){var r=e.yAxes;t.save();lt(t);vt(t,a.yLabelColor,a);t.lineWidth=ot===1?2:1.5;var s=0;var n=0;var h=true;for(var o=0;o<r.length;o+=1){var l=r[o];var v=l.color,d=l.ticks,f=l.scale,p=l.stick,g=l.visible,m=l.percentage;if(!(g||$(l,"opacity"))){continue}var b=(m?1/d.max:f)*i.height;if(v){t.fillStyle=v}t.strokeStyle=a.gridColor;t.textAlign=p;t.beginPath();t.globalAlpha=l.opacity;for(var x=d.min;x<d.max;x+=d.step){var C=Math.round(i.height-(x-d.min)*b);var w=i.x;t.fillText(x,p===u?w+s:i.width+w+n,C-7);if(h){t.moveTo(w,C);t.lineTo(i.width,C)}}t.stroke();h=false;var y=t.measureText(d.max).width+c;if(p===u){s+=y}else{n-=y}}t.restore()}function pt(t,e,i,a){var r=e.xAxis,s=e.endIndex;t.save();lt(t);vt(t,a.xLabelColor,a);t.textAlign="center";var n=r.scale*i.width;var h=r.offset*i.width;var o=r.startIndex;while(o<s){t.globalAlpha=r.getOpacity(o);t.fillText(r.getLabel(o),o*n+h,i.height+i.y-4);o+=r.tickStep}t.restore()}function gt(t,e,i,n,h){var o=e.data,l=e.xAxis;t.save();lt(t);var c=ot===1?2:1.5;var u=l.scale*n.width;var v=l.offset*n.width;var d=i*u+v;var f=false;var p=false;for(var g=0;g<o.length;g+=1){var m=o[g];if(!m.visible){continue}var b=m.type;if(b===a||b===r){f=true}else if(b===s){p=true}}if(f){t.beginPath();t.lineWidth=c;t.strokeStyle=h.cursorLineColor;t.moveTo(d,0);t.lineTo(d,n.height);t.stroke()}if(p){t.fillStyle=h.cursorFadeColor;var x=d-u/2;t.fillRect(n.x,n.y,x,n.height);x=d+u/2;t.fillRect(x,n.y,n.width-x,n.height)}for(var C=0;C<o.length;C+=1){var w=o[C];if(!w.visible){continue}var b=w.type,y=w.yAxis;var S=n.height*y.scale;if(b===a){t.beginPath();t.strokeStyle=w.color;t.lineWidth="3";t.fillStyle=h.backgroundColor;t.arc(d,n.height-(w.column[i]-y.ticks.min)*S,6,0,2*Math.PI);t.fill();t.stroke()}}t.restore()}var mt={fontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Light", Helvetica, Arial , Verdana, sans-serif',fontSize:"15px",backgroundColor:"#ffffff",cursorLineColor:"rgba(24,45,59,.1)",cursorFadeColor:"rgba(255,255,255,.5)",gridColor:"rgba(24,45,59,.1)",xLabelColor:"rgba(37,37,41,0.5)",yLabelColor:"rgba(37,37,41,0.5)"};var bt={fontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Light", Helvetica, Arial , Verdana, sans-serif',fontSize:"15px",backgroundColor:"#242F3E",cursorLineColor:"rgba(255,255,255,.2)",cursorFadeColor:"rgba(36,47,62,.5)",gridColor:"rgba(255,255,255,.1)",xLabelColor:"rgba(163,177,194,0.6)",yLabelColor:"rgba(236,242,248,0.5)"};var xt=Object.freeze({day:mt,night:bt});var Ct={chartWrap:"Chart_chartWrap-13R36",day:"Chart_day-1hPoJ",bubble:"Chart_bubble-3NMVD",night:"Chart_night-2z16N",noData:"Chart_noData-3MF8u",header:"Chart_header-3lmAk",range:"Chart_range-1c0_Z",charts:"Chart_charts-3KEDM",canvas:"Chart_canvas-3MU0P",cursorZone:"Chart_cursorZone-1IxmZ",bubbleDate:"Chart_bubbleDate-s4zYX",bubbleContent:"Chart_bubbleContent-3M7g5",bubbleItem:"Chart_bubbleItem-1d5Lj",bubbleVal:"Chart_bubbleVal-2qwdV",table:"Chart_table-23YYP",tdPercents:"Chart_tdPercents-3iIds",tdValue:"Chart_tdValue-3Jtfa"};function wt(t){return'<table class="'+Ct.table+'"><tbody>'+t+"</tbody></table>"}function yt(t,e,i,a,r){var s="";if(r){s+='<td class="'+Ct.tdPercents+'">'+(a>>0)+"%</td>"}s+='<td class="'+Ct.tdName+'">'+t+"</td>";s+='<td class="'+Ct.tdValue+'" style="color: '+i+';">'+e+"</td>";return"<tr>"+s+"</tr>"}function St(t,e){var i=t.data,a=t.xAxis.dates;var r=g(t);var s="";var n='<div class="'+Ct.bubbleDate+'">'+P(a[e])+"</div>";i.forEach(function(t){if(!t.visible){return}var i=t.color,a=t.column,n=t.name,h=t.yAxis;var o=h.percentage?a[e]*100/h.totalStacked[e]:null;s+=yt(n,a[e],i,o,r)});var h='<div class="'+Ct.bubbleContent+'">'+wt(s)+"</div>";return'<div class="'+Ct.bubbleWrap+'">'+n+h+"</div>"}var kt=function(){function t(t,e,i,a){this.theme=null;this.themeName=null;this.defaultRange=[.75,1];this.state=new nt(i);this.changes={range:null,visible:null};this.drawing=false;this.initDom(t);this.initScroll();this.initFilter();this.initContext();this.initCursor();O(this,["redraw"]);this.setHeader(e);this.setTheme(a);this.update()}var e=t.prototype;e.initDom=function t(e){this.$el=z("div",Ct.chartWrap);this.$header=z("div",Ct.header);this.$range=z("div",Ct.range);this.$charts=z("div",Ct.charts);this.$chartsCanvas=z("canvas",Ct.canvas);this.$deskCanvas=z("canvas",Ct.canvas);this.$cursorZone=z("div",Ct.cursorZone);this.$bubble=z("div",Ct.bubble);V(this.$bubble);this.$cursorZone.appendChild(this.$bubble);this.$charts.appendChild(this.$chartsCanvas);this.$charts.appendChild(this.$deskCanvas);this.$charts.appendChild(this.$cursorZone);this.$el.appendChild(this.$header);this.$el.appendChild(this.$range);this.$el.appendChild(this.$charts);e.appendChild(this.$el)};e.initContext=function t(){this.chartsCtx=ct(this.$chartsCanvas);this.deskCtx=ct(this.$deskCanvas);this.previewCtx=ct(this.scroll.$canvas)};e.initFilter=function t(){var e=this;this.filter=new K(this.state,function(t,i){return e.setVisible(t,i)});this.$el.appendChild(this.filter.$el)};e.initScroll=function t(){var e=this;this.scroll=new at(this.defaultRange,.01,function(t){return e.setRange(t)});this.$el.appendChild(this.scroll.$el);this.scroll.update()};e.initCursor=function t(){O(this,["handleCursorStart","handleCursorMove","handleCursorEnd"]);this.showCursor=false;this.cursorIndex=null;Y(this.$cursorZone,"mouseenter,touchstart",this.handleCursorStart)};e.update=function t(){this.updateScene();this.state.prepareXAxis(this.vp.main.width);this.scroll.update();this.state.setRange(this.scroll.range,true);this.draw();this.drawPreview();this.updateRange()};e.updateScene=function t(){var e=this.$chartsCanvas,i=this.$deskCanvas,a=this.scroll.$canvas;var r=e.offsetHeight,s=e.offsetWidth;var h=a.offsetHeight,o=a.offsetWidth;var l=ht();[e,i,a].forEach(function(t){t.height=t.offsetHeight*l;t.width=t.offsetWidth*l});this.vp={main:D(0,0,s,r),charts:D(0,0,s,r-n),preview:D(0,0,o,h)}};e.updateRange=function t(){var e=this.state,i=e.startIndex,a=e.endIndex,r=e.xAxis.dates;this.$range.innerText=L(r[i])+" - "+L(r[a])};e.setHeader=function t(e){this.$header.innerText=e};e.setTheme=function t(e){if(this.themeName!==e){if(this.theme){X(this.$el,Ct[this.themeName])}Z(this.$el,Ct[e]);this.theme=xt[e];this.themeName=e;this.scroll.setTheme(e);this.filter.setTheme(e);this.update()}};e.setRange=function t(e){this.changes.range=e;this.scheduleChanges()};e.setVisible=function t(e,i){this.changes.visible={id:e,visible:i};this.scheduleChanges()};e.scheduleChanges=function t(){if(!this.drawing){this.drawing=true;W(this.redraw)}};e.redraw=function t(e){var i=this.changes,a=this.state;a.ts=e;a.tick();if(i.range){a.setRange(i.range);i.range=null}else if(i.visible){a.setVisible(i.visible.id,i.visible.visible);i.visible=null;this.drawPreview()}else{this.drawPreview()}this.updateRange();this.draw();if(a.haveTransitions){W(this.redraw)}else{this.drawing=false}};e.draw=function t(){var e=this.theme;ut(this.chartsCtx,this.vp.main);dt(this.chartsCtx,this.state,this.vp.charts,false,3,e);ut(this.deskCtx,this.vp.main);this.drawAxes()};e.drawPreview=function t(){if(this.scroll.visible){ut(this.previewCtx,this.vp.preview);dt(this.previewCtx,this.state,this.vp.preview,true)}};e.drawAxes=function t(){var e=this.theme;ft(this.deskCtx,this.state,this.vp.charts,e);pt(this.deskCtx,this.state,this.vp.main,e)};e.attachCursorEvents=function t(){Y(this.$cursorZone,"mousemove,touchmove",this.handleCursorMove);Y(this.$cursorZone,"mouseleave,touchend,touchcancel",this.handleCursorEnd)};e.detachCursorEvents=function t(){q(this.$cursorZone,"mousemove,touchmove",this.handleCursorMove);q(this.$cursorZone,"mouseleave,touchend,touchcancel",this.handleCursorEnd)};e.handleCursorStart=function t(e){this.showCursor=true;this.attachCursorEvents();this.moveCursor(U(e))};e.handleCursorMove=function t(e){if(this.showCursor){this.moveCursor(U(e))}else{this.hideCursor()}};e.handleCursorEnd=function t(){this.hideCursor()};e.moveCursor=function t(e){var i=this;var a=this.deskCtx,r=this.state,s=this.vp,n=this.theme;W(function(){var t=r.xAxis;var h=Math.round((e/s.charts.width-t.offset)/t.scale);if(h<r.startIndex){h=r.startIndex}else if(h>r.endIndex){h=r.endIndex}if(i.cursorIndex!==h){i.cursorIndex=h;i.renderBubble();ut(a,i.vp.main);gt(a,r,h,s.charts,n);i.drawAxes()}})};e.hideCursor=function t(){var e=this;this.showCursor=false;this.cursorIndex=null;this.detachCursorEvents();V(this.$bubble);W(function(){ut(e.deskCtx,e.vp.main);e.drawAxes()})};e.renderBubble=function t(){var e=this.$bubble,i=this.state,a=this.cursorIndex,r=this.vp;if(!this.showCursor){return}J(e);var s=i.xAxis;e.innerHTML=St(i,a);var n=e.offsetWidth;var h=s.scale*r.main.width;var o=s.offset*r.main.width;var l=Math.round(a*h+o);var c=l-n-20;if(c<20){c=l+20}e.style.left=c+"px"};return t}();return kt});
